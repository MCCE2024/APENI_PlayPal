server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Proxy API requests to Matching Service
    location /api/matching/ {
        # Rewrite /api/matching/... to /matching/... is achieved by stripping /api/ prefix logic if we passed it to root.
        # But matching-service expects /matching prefix.
        # Request: /api/matching/requests
        # We want backend to receive: /matching/requests
        
        # If we use simple proxy_pass without URI part:
        # location /api/ { proxy_pass http://backend; } 
        # nginx sends /api/matching... to backend. Backend needs to ignore /api.
        
        # If we use trailing slash in proxy_pass:
        # location /api/ { proxy_pass http://backend/; }
        # nginx replaces /api/ with /. Request /api/matching becomes /matching.
        
        # However, we have multiple services.
        
        # Let's match specific prefix
        proxy_pass http://matching-service.playpal.svc.cluster.local:3000/matching/;
    }

    location /api/notification/ {
        proxy_pass http://notification-service.playpal.svc.cluster.local:3000/notification/;
    }

    # SPA Fallback
    location / {
        try_files $uri $uri/ /index.html;
    }
}
